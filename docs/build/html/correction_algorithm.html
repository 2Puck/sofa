<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Channels" href="channels.html" /><link rel="prev" title="Supported Data Types" href="supported_data_types.html" />

    <meta name="generator" content="sphinx-5.1.1, furo 2022.04.07"/>
        <title>Correction Algorithm - SOFA</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">SOFA</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">SOFA</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="atomic_force_spectroscopy.html">Atomic Force Spectroscopy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="using_sofa.html">Using SOFA</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="supported_data_types.html">Supported Data Types</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Correction Algorithm</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="channels.html">Channels</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="toolbars.html">Toolbars</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Software Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="codebase.html">Codebase</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="correction-algorithm">
<span id="id1"></span><h1>Correction Algorithm<a class="headerlink" href="#correction-algorithm" title="Permalink to this heading">#</a></h1>
<p>To be able to analyze the imported measurement data statistically, for example average a subgroup of force curves, the data needs to be corrected. Due to the experiment setup each force curve is exposed to a topography offset and a virtual deflection, shifting the curve in the x and y direction. SOFA automatically tries to shift the point of contact of each force curve to zero, correcting the errors and alignig all curves. SOFA relies on the fact that Force Curves are expected to have a certain typical shape in order to interpret the contact between probe and sample according to theories and physical models. When the quality of the force curves decreases SOFA might not be able to correct them anymore. Below some cases are listed, for which SOFA can not correct the data.</p>
<ul class="simple">
<li><p>In case a curve shows any deviation from F = 0 for Z &lt; 0 beyond certain noise, the point of contact can not be identified conclusively.</p></li>
<li><p><strong>WELCHE ANDEREN FÄLLE GIBT ES NOCH</strong>.</p></li>
</ul>
<p>Force curves which can not be corrected are discarded by SOFA. For more detailed information about the edge cases SOFA can’t currently handle, see the <a class="reference internal" href="codebase.html#tests-implementation"><span class="std std-ref">Tests</span></a> section. To shift the point of contact of a single force curve to zero, first its <a class="reference internal" href="#correction-force"><span class="std std-ref">force values</span></a> and then the <a class="reference internal" href="#correction-piezo"><span class="std std-ref">pizeo values</span></a> are corrected.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Up to version 1.0 SOFA processes only the approach part of every imported force distance curve.</p>
</div>
<div class="section" id="correction-of-the-force">
<span id="correction-force"></span><h2>Correction of the force<a class="headerlink" href="#correction-of-the-force" title="Permalink to this heading">#</a></h2>
<div class="figure align-default" id="id4">
<a class="reference internal image-reference" href="_images/force_correction.svg"><img alt="image of the correction of the force values of an approach part of a force distance curve" src="_images/force_correction.svg" width="600"/></a>
<p class="caption"><span class="caption-text">Correction of the force values of an approach part of a force distance curve.</span><a class="headerlink" href="#id4" title="Permalink to this image">#</a></p>
</div>
<p>To correct the virtual deflection the force distance curve is shifted to zero along the deflection (y) axis using the end of the zeroline. Additionally the noise in the deflection values before the point of contact is smoothed. For this, the <a class="reference internal" href="#calculate-end-of-zero-line"><span class="std std-ref">end of the zero line</span></a> must first be found. With the end of the zero line a <a class="reference internal" href="#fit-zero-line"><span class="std std-ref">fit of the zero line</span></a> can be calculated. Using this fit the deflection values are <a class="reference internal" href="#fit-zero-line"><span class="std std-ref">shifted along the deflection (y) axis</span></a>.</p>
<div class="section" id="calculate-the-end-of-the-zero-line">
<span id="calculate-end-of-zero-line"></span><h3>Calculate the end of the zero line<a class="headerlink" href="#calculate-the-end-of-the-zero-line" title="Permalink to this heading">#</a></h3>
<p>The end of the zero line is the last measurement point before attractive forces start to appear between the probe and sample. In other words it is the last measurement point with a positive slope before the jump to contact. To calculate the end of the zero line the <a class="reference internal" href="#restrict-search-area"><span class="std std-ref">search area is first restricted</span></a>. Afterwards the end of the zero line can be <a class="reference internal" href="#locate-end-of-zero-line"><span class="std std-ref">located within this area</span></a>.</p>
<div class="section" id="restrict-search-area">
<span id="id2"></span><h4>Restrict search area<a class="headerlink" href="#restrict-search-area" title="Permalink to this heading">#</a></h4>
<div class="figure align-default" id="id5">
<a class="reference internal image-reference" href="_images/restrict_search_area.svg"><img alt="image of the restriction process to find the end of the zero line" src="_images/restrict_search_area.svg" width="600"/></a>
<p class="caption"><span class="caption-text">text.</span><a class="headerlink" href="#id5" title="Permalink to this image">#</a></p>
</div>
<p>In order to narrow down the area where the end of the zero line is located, a left and right boundary is calculated. For this a linear fit to the approach curve is calculated. The slope and interception values of this linear fit are cached and used to calculate the <a class="reference internal" href="channels.html#raw-offset-stiffness"><span class="std std-ref">raw offset and raw stiffness</span></a> channel. The left boundary is the first point of the approach curve where it’s deflection value is smaller than that of the linear fit, similar to the first intersection point between the two curves. To determine the right boundary the second intersection point of the approach curve and it’s linear fit is defined as the last point of the approach curve where it’s deflection value is smaller than that of the linear fit. Subsequently the differences between the deflection values of the approach curve and the linear fit are calculated. Then the point with the maximum deflection difference within the area of the left and right intersection is determined. From this point, the right boundary is obtained by shifting the point slighty to the right. The exact amount is five percent of the difference between the right intersection and the point with the maximum deflection difference. After determining the left and right borders the end of the zero line can be located.</p>
</div>
<div class="section" id="locate-the-end-of-the-zero-line">
<span id="locate-end-of-zero-line"></span><h4>Locate the end of the zero line<a class="headerlink" href="#locate-the-end-of-the-zero-line" title="Permalink to this heading">#</a></h4>
<p>To find the measurement point with the first negative slope before the jump to contact the approach curve must first be derived. Afterwards the first derivation is smoothed by a faussian filter with a smooth factor of 10. The first point of the smoothed first derivation of the deflection values within the left and right boundary wiht a negative slope is determined as the end of the zero line. The end of the zero line is later used to calculate the length of the attractive area which is needed to calculate the <a class="reference internal" href="channels.html#attractive-area-z-attractive"><span class="std std-ref">attractive area and z attractive channel</span></a>. If there is no point with a negative slope in this area, the force distance curve cannot be corrected and the correction process is aborted for this curve.</p>
</div>
</div>
<div class="section" id="fit-the-zero-line">
<span id="fit-zero-line"></span><h3>Fit the zero line<a class="headerlink" href="#fit-the-zero-line" title="Permalink to this heading">#</a></h3>
<p>With the end of the zero line another linear fit of the approach curve until the end of the zero line is calculated.</p>
</div>
<div class="section" id="shift-the-force-values">
<span id="shift-force-values"></span><h3>Shift the force values<a class="headerlink" href="#shift-the-force-values" title="Permalink to this heading">#</a></h3>
<p>Using the linear fit of the approach curve until the end of the zero line the deflection values can be corrected. For this the deflection values of the linear fit are subtracted from the deflection values of the approach curve until the point of contact. The remaining deflection values of the approach curve are subtracted by the last deflection value of the linear fit of the end of the zero line.</p>
</div>
</div>
<div class="section" id="correction-of-the-piezo-displacement">
<span id="correction-piezo"></span><h2>Correction of the piezo displacement<a class="headerlink" href="#correction-of-the-piezo-displacement" title="Permalink to this heading">#</a></h2>
<div class="figure align-default" id="id6">
<a class="reference internal image-reference" href="_images/piezo_correction.svg"><img alt="image of the correction of the piezo values of an approach part of a force distance curve" src="_images/piezo_correction.svg" width="800"/></a>
<p class="caption"><span class="caption-text">Correction of the piezo values of an approach part of a force distance curve.</span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</div>
<p>To correct the topography offset the force distance curve is shifted to zero along the piezo (x) axis using the point of contact. This can only be done after the correction of the deflection values, since the point of contact is defined as the first zero crossing after the jump to contact. First the <a class="reference internal" href="#calculate-zero-crossing"><span class="std std-ref">zero crossing</span></a> is determined. Afterwards the exact <a class="reference internal" href="#interpolate-point-of-contact"><span class="std std-ref">point of contact is calculated</span></a>. Finally the pizeo values of the approach curve can be <a class="reference internal" href="#shift-piezo-values"><span class="std std-ref">shifted using the point of contact</span></a>.</p>
<div class="section" id="calculate-the-zero-crossing">
<span id="calculate-zero-crossing"></span><h3>Calculate the zero crossing<a class="headerlink" href="#calculate-the-zero-crossing" title="Permalink to this heading">#</a></h3>
<p>Locates the first zero crossing of the corrected deflection values. This point is defined as the last measurement point with a negative deflection value after the end of the zero line. If there are no points with negative deflection values after the end of the zeroline, the force distance curve cannot be corrected and the correction process is aborted for this curve.</p>
</div>
<div class="section" id="interpolate-point-of-contact">
<span id="id3"></span><h3>Interpolate point of contact<a class="headerlink" href="#interpolate-point-of-contact" title="Permalink to this heading">#</a></h3>
<p>With the last measurement point before the zero crossing the exact piezo value at which the deflection becomes zero is calculated.</p>
</div>
<div class="section" id="shift-the-piezo-values">
<span id="shift-piezo-values"></span><h3>Shift the piezo values<a class="headerlink" href="#shift-the-piezo-values" title="Permalink to this heading">#</a></h3>
<p>The piezo values of the measurement curve are subtracted by the piezo value of the point of contact shifting the point of contact to (0, 0) and completing the correction process of the force distance curve.</p>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="channels.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Channels</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="supported_data_types.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Supported Data Types</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Schleiser Tim, Dorothee Silbernagl, Fritzsche Sven
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/2Puck/sofa" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Correction Algorithm</a><ul>
<li><a class="reference internal" href="#correction-of-the-force">Correction of the force</a><ul>
<li><a class="reference internal" href="#calculate-the-end-of-the-zero-line">Calculate the end of the zero line</a><ul>
<li><a class="reference internal" href="#restrict-search-area">Restrict search area</a></li>
<li><a class="reference internal" href="#locate-the-end-of-the-zero-line">Locate the end of the zero line</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fit-the-zero-line">Fit the zero line</a></li>
<li><a class="reference internal" href="#shift-the-force-values">Shift the force values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#correction-of-the-piezo-displacement">Correction of the piezo displacement</a><ul>
<li><a class="reference internal" href="#calculate-the-zero-crossing">Calculate the zero crossing</a></li>
<li><a class="reference internal" href="#interpolate-point-of-contact">Interpolate point of contact</a></li>
<li><a class="reference internal" href="#shift-the-piezo-values">Shift the piezo values</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>